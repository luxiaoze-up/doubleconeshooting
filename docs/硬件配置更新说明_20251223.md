# 双锥项目硬件配置更新说明

**更新日期**: 2025年12月23日  
**参考文档**: `docs/双锥项目测试数据收集.pdf`  
**更新人**: 系统集成团队

---

## 一、运动控制器IP地址重新分配

### 变更前后对比

| 控制器 | 旧IP配置 | 新IP配置 | 控制设备 |
|--------|---------|---------|---------|
| **控制器1** | 192.168.1.11 (辅助支撑) | 192.168.1.11 (六自由度+大行程+IO控制) | 六自由度(AXIS 0-5), 大行程(AXIS 6), 驱动器/刹车供电控制(OUT 0-6) |
| **控制器2** | 192.168.1.12 (反射光成像) | 192.168.1.12 (反射光成像) | 反射光成像上下平台(AXIS 0-5) |
| **控制器3** | 192.168.1.13 (六自由度+大行程) | 192.168.1.13 (辅助支撑) | 辅助支撑1-5(AXIS 0-4) |

### 调整原因
将驱动器上电控制、刹车供电控制集中到 **192.168.1.11** 控制器的OUT端口统一管理。

---

## 二、电机细分数统一修改

### 变更详情
所有电机细分数从混合配置统一调整为：**12800 转/圈**

| 设备模块 | 旧细分数 | 新细分数 | 备注 |
|---------|---------|---------|------|
| 六自由度(6轴) | 25600 | **12800** | YC42248-13-AEB-BK-HV-NT |
| 大行程(1轴) | 4000 | **12800** | YC862118-50-AEB-BK-HV |
| 反射光成像(6轴) | 4000 | **12800** | YC42E248-10 / YC57276-20 |
| 辅助支撑(5轴) | 4000 | **12800** | YC57276-20-AEB |

### 拨码开关设置
```
细分拨码: 1 2 3 4
设置:     OFF OFF ON ON  →  12800转/圈
```

---

## 三、驱动器上电信号配置（新增）

通过运动控制器 **192.168.1.11** 的数字输出端口控制各驱动器电源：

| 模块 | 驱动器上电端口 | 控制电机 |
|------|---------------|---------|
| 六自由度 | OUT0 | M1-M6 (6个电机共用) |
| 大行程 | OUT0 | M7 (与六自由度共用OUT0) |
| 反射光成像 | OUT5 | M8-M13 (6个电机) |
| 辅助支撑 | OUT6 | M14-M18 (5个电机) |

### 实现方式
设备初始化时自动写入 `OUT端口 = HIGH` 启动驱动器电源。

---

## 四、电机刹车供电控制（新增）

针对带刹车的电机，通过运动控制器 **192.168.1.11** 的数字输出端口控制：

| 模块 | 刹车供电端口 | 控制电机 | 备注 |
|------|-------------|---------|------|
| 六自由度 | OUT3 | M1-M6 | 24V刹车供电 |
| 大行程 | OUT4 | M7 | 24V刹车供电 |

### 刹车控制逻辑
- **OUT = LOW**: 刹车启用（电机锁定）
- **OUT = HIGH**: 刹车释放（电机可运动）

---

## 五、相机上电信号配置（待实现）

根据测试数据表，相机上电信号配置暂未明确。建议：
- 上平台CCD 1x/10x: 通过独立电源或PLC控制
- 下平台CCD 1x/10x: 通过独立电源或PLC控制

**TODO**: 需要确认相机供电方式（是否通过运动控制器OUT端口或独立电源）

---

## 六、代码修改清单

### 6.1 配置文件
- ✅ `config/devices_config.json` - 更新所有设备的IP、细分数、上电/刹车控制端口

### 6.2 设备初始化代码（已修改）
- ✅ `src/device_services/six_dof_device.cpp` - 更新细分数默认值
- ✅ `src/device_services/large_stroke_device.cpp` - 更新IP和细分数
- ✅ `src/device_services/auxiliary_support_device.cpp` - 更新IP和细分数
- ✅ `src/device_services/reflection_imaging_device.cpp` - 更新细分数

### 6.3 功能增强（需实现）
- ⚠️ **驱动器上电控制** - 需要在设备初始化时调用运动控制器的 `writeIO` 命令
- ⚠️ **刹车供电控制** - 需要在运动前释放刹车，停止后启用刹车
- ❓ **相机上电控制** - 待确认具体控制方式

---

## 七、测试验证计划

### 7.1 基础连接测试
```bash
# 测试新IP地址连接
ping 192.168.1.11
ping 192.168.1.12
ping 192.168.1.13

# 测试编码器连接
ping 192.168.1.199
ping 192.168.1.198
```

### 7.2 细分数验证
通过测试程序验证各轴的脉冲当量是否正确设置为12800。

### 7.3 IO控制测试
- 验证OUT0启动六自由度/大行程驱动器
- 验证OUT5启动反射光成像驱动器
- 验证OUT6启动辅助支撑驱动器
- 验证OUT3/OUT4控制刹车释放

---

## 八、注意事项

⚠️ **重要提醒**：
1. **断电操作**: 修改硬件连接前必须断电
2. **拨码开关**: 确认所有驱动器的细分拨码已调整为 `OFF OFF ON ON`
3. **刹车控制**: 上电顺序为 `驱动器电源 → 刹车释放 → 运动控制`
4. **备份配置**: 旧配置已保存在 `config/devices_config.json.backup`

---

## 九、后续工作

- [ ] 实现驱动器上电自动控制功能
- [ ] 实现刹车自动释放/锁定功能
- [ ] 确认并实现相机上电控制
- [ ] 现场测试所有轴的运动精度
- [ ] 更新用户操作手册

---

**文档维护**: 如有硬件配置变更，请及时更新本文档。

